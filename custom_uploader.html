<!DOCTYPE html>
<html>
<body>
  <input type="file" id="uploader" multiple />
  <script>
    const uploader = document.getElementById('uploader');
    const results = [];

    uploader.addEventListener('change', () => {
      const files = uploader.files;
      const promises = [];

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const promise = new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = () => {
            const base64 = reader.result.split(',')[1];
            resolve({ name: file.name, content: base64 });
          };
          reader.readAsDataURL(file);
        });
        promises.push(promise);
      }

      Promise.all(promises).then((allFiles) => {
        const payload = JSON.stringify(allFiles);
        window.parent.postMessage({ isStreamlitMessage: true, type: "streamlit:setComponentValue", value: payload }, "*");
      });
    });
  </script>
</body>
</html>
